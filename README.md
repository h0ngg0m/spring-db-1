# JDBC (Java Database Connectivity)
JDBC는 자바에서 데이터베이스에 접속할 수 있도록 하는 자바 API다.   
JDBC는 데이터베이스에서 자료를 쿼리하거나 업데이트하는 방법을 제공한다.

대표적으로 다음 3가지 기능을 표준 인터페이스로 정의해서 제공한다.
1. java.sql.Connection: 데이터베이스에 접속하기 위한 객체
2. java.sql.Statement: SQL문을 데이터베이스로 전송하기 위한 객체
3. java.sql.ResultSet: SQL문 실행 결과를 저장하는 객체

# DataSource
커넥션을 획득하는 방법을 추상화한 인터페이스이다.
```java
public interface DataSource {
    Connection getConnection() throws SQLException;
}
```

# 데이터베이스 연결 구조와 DB 세션
- 사용자는 웹 애플리케이션 서버(WAS)나 DB 접근 툴 같은 클라이언트를 사용해서 데이터베이스 서버에 접근할 수 있다. 클라이언트는 데이터베이스
서버에 연결을 요청하고 커넥션을 맺게 된다. 이때 데이터베이스 서버는 내부에 세션이라는 것을 만든다. 그리고 앞으로 해당 커넥션을 통한 모든 요청은 이 세션을 통해서 실행하게 된다.
  - 쉽게 이야기해서 개발자가 클라이언트를 통해 SQL을 전달하면 현재 커넥션에 연결된 세션이 SQL을 실행한다.
- 세션은 트랜잭션을 시작하고, 커밋 또는 롤백을 통해 트랜잭션을 종료한다. 그리고 이후에 새로운 트랜잭션을 다시 시작할 수 있다.
- 사용자가 커넥션을 닫거나, 또는 DBA가 세션을 강제로 종료하면 세션은 종료된다.

# 스프링 예외 추상화 이해
스프링은 앞서 설명한 문제들을 해결하기 위해 데이터 접근과 관련된 예외를 추상화해서 제공한다. 

## 스프링 데이터 접근 예외 계층
<img width="705" alt="Screenshot 2024-05-20 at 6 21 29 PM" src="https://github.com/h0ngg0m/spring-db-1/assets/125632083/0c568de1-74d7-49dd-8bef-e7ace9d7383c">

- 스프링은 데이터 접근 계층에 대한 수십 가지 예외를 정리해서 일관된 예외 계층을 제공한다.
- 각각의 예외는 특정 기술에 종속적이지 않게 설계되어 있다. 따라서 서비스 계층에서도 스프링이 제공하는 예외를 사용하면 된다. 예를 들어서 JDBC 기술을 사용하든, JPA 기술을 사용하든 스프링이 제공하는 예외를 사용하면 된다.
- JDBC나 JPA를 사용할 때 발생하는 예외를 스프링이 제공하는 예외로 변환해주는 역할도 스프링이 제공한다.
- 참고로 그림을 단순화 하기 위해 일부 계층을 생략했다.
<br>

- 예외의 최고 상위는 `org.springframework.dao.DataAccessException` 이다. 그림에서 보는 것 처럼 런타임 예외를 상속 받았기 때문에 스프링이 제공하는 데이터 접근 계층의 모든 예외는 런타임 예외이다.
- `DataAccessException` 은 크게 2가지로 구분하는데 `NonTransient` 예외와 `Transient` 예외이다.
  - `Transient` 는 일시적이라는 뜻이다. `Transient` 하위 예외는 동일한 SQL을 다시 시도했을 때 성공할 가능성이 있다.
    - 예를 들어서 쿼리 타임아웃, 락과 관련된 오류들이다. 이런 오류들은 데이터베이스 상태가 좋아지거나, 락이 풀렸을 때 다시 시도하면 성공할 수 도 있다.
  - `NonTransient` 는 일시적이지 않다는 뜻이다. 같은 SQL을 그대로 반복해서 실행하면 실패한다.
    - SQL 문법 오류, 데이터베이스 제약조건 위배 등이 있다.

## 트랜잭션 AOP 흐름

<img width="858" alt="Screenshot 2024-05-24 at 12 29 30 PM" src="https://github.com/h0ngg0m/spring-db-1/assets/125632083/f67e673b-0657-4514-9119-072fd311bbb4">
